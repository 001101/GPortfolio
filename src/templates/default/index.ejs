<!DOCTYPE html>
<%
const headTemplate = require('ejs-loader!@src/parts/head.ejs')
const imagesTemplate = require('ejs-loader!@src/parts/images.ejs')
const safeQuotes = (str) => str.replace(/"/g, '&quot;')
%>
<html lang="en" data-template="default" data-compiled="<%= Date.now() %>">
<head>
  <%= headTemplate({ profile, config, url }) %>
  <%= imagesTemplate({
    avatar: profile.avatar_url,
    background: config.templates.default.background,
    defaultBackground: require('@/assets/background.png')
  }) %>
</head>
<body>
<header>
  <div class="header__background background--image"></div>
  <div class="header__wrap">
    <div class="header__wrap__image">
      <div class="avatar--image"></div>
    </div>
    <h1 class="header__wrap__name"><%= profile.name %></h1>
    <% if (config.position) { %>
    <span class="header__wrap__position"><%= config.position %></span>
    <% } %>
    <% if (config.socialMedia.length > 0) { %>
    <div class="header__wrap__social">
      <% for (const media of config.socialMedia) { %>
      <a href="<%= media.link %>" title="<%= safeQuotes(media.name) %>" target="_blank" rel="noopener">
        <%= require(`!!svg-inline-loader!@asset/upstream/icons/${media.icon}.svg`) %>
      </a>
      <% } %>
    </div>
    <% } %>
  </div>
</header>
<main>
  <section class="repositories-section">
    <h2>Repositories</h2>
    <div class="repositories">
      <% for (const rep of repositories) { %>
      <a href="<%= rep.html_url %>" class="repository" target="_blank" rel="noopener">
        <div class="repository__name"><%= rep.full_name %></div>
        <div class="repository__description"><%= rep.description || '-' %></div>
        <div class="repository__bottom">
          <div class="repository__bottom__language">
            <%= require(`!!svg-inline-loader!@asset/upstream/icons/code.svg`) %>
            <span><%= rep.language || '-' %></span>
          </div>
          <div class="repository__bottom__star">
            <%= require(`!!svg-inline-loader!@asset/upstream/icons/star.svg`) %>
            <span><%= rep.stargazers_count %></span>
          </div>
          <div class="repository__bottom__forks">
            <%= require(`!!svg-inline-loader!@asset/upstream/icons/fork.svg`) %>
            <span><%= rep.forks_count %></span>
          </div>
        </div>
      </a>
      <% } %>
    </div>
  </section>
  <% if (dribbble && dribbble.shots.length) { %>
  <section class="dribbble-shots-section">
    <h2>Shots</h2>
    <div class="dribbble-shots">
    <% for (const shot of dribbble.shots) { %>
      <a href="<%= shot.html_url %>" class="dribbble-shot" target="_blank" rel="noopener"
         style="background-image: url(<%= shot.images.normal %>)">
        <div class="dribbble-shot__title"><%= shot.title %></div>
        <div class="dribbble-shot__published_at">
          <%= new Date(shot.published_at).toLocaleDateString(undefined, {
            year: 'numeric',
            day: '2-digit',
            month: '2-digit'
          }) %>
        </div>
      </a>
    <% } %>
    </div>
  </section>
  <% } %>
</main>
<footer>
  <span><%= new Date().toLocaleDateString(undefined, {
    year: 'numeric',
    day: '2-digit',
    month: '2-digit'
  }) %></span>
</footer>
</body>
</html>
